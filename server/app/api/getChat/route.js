"use strict";(()=>{var e={};e.id=736,e.ids=[736],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3090:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>m,patchFetch:()=>v,requestAsyncStorage:()=>p,routeModule:()=>d,serverHooks:()=>f,staticGenerationAsyncStorage:()=>h});var n={};r.r(n),r.d(n,{POST:()=>u,maxDuration:()=>l});var a=r(9303),o=r(8716),s=r(670);let i=[239,187,191];async function c(e){let t=new TextEncoder,r=new TextDecoder,n=await fetch(process.env.LLAMAEDGE_BASE_URL+"/chat/completions",{headers:{"Content-Type":"application/json","Helicone-Auth":`Bearer ${process.env.LLAMAEDGE_API_KEY}`,Authorization:`Bearer ${process.env.LLAMAEDGE_API_KEY??""}`},method:"POST",body:JSON.stringify(e)}),a=new ReadableStream({async start(e){if(200!==n.status){let t={status:n.status,statusText:n.statusText,body:await n.text()};console.log(`Error: recieved non-200 status code, ${JSON.stringify(t)}`),e.close();return}let a=function(e){let t,r,n,a,o,s,c;return l(),{feed:function(l){var u;r=r?r+l:l,t&&(u=r,i.every((e,t)=>u.charCodeAt(t)===e))&&(r=r.slice(i.length)),t=!1;let d=r.length,p=0,h=!1;for(;p<d;){let t;h&&("\n"===r[p]&&++p,h=!1);let i=-1,l=a;for(let e=n;i<0&&e<d;++e)":"===(t=r[e])&&l<0?l=e-p:"\r"===t?(h=!0,i=e-p):"\n"===t&&(i=e-p);if(i<0){n=d-p,a=l;break}n=0,a=-1,function(t,r,n,a){if(0===a){c.length>0&&(e({type:"event",id:o,event:s||void 0,data:c.slice(0,-1)}),c="",o=void 0),s=void 0;return}let i=n<0,l=t.slice(r,r+(i?a:n)),u=0;u=i?a:" "===t[r+n+1]?n+2:n+1;let d=r+u,p=a-u,h=t.slice(d,d+p).toString();if("data"===l)c+=h?"".concat(h,"\n"):"\n";else if("event"===l)s=h;else if("id"!==l||h.includes("\0")){if("retry"===l){let t=parseInt(h,10);Number.isNaN(t)||e({type:"reconnect-interval",value:t})}}else o=h}(r,p,l,i),p+=i+1}p===d?r="":p>0&&(r=r.slice(p))},reset:l};function l(){t=!0,r="",n=0,a=-1,o=void 0,s=void 0,c=""}}(r=>{if("event"===r.type){let n=r.data;e.enqueue(t.encode(n))}});for await(let e of n.body)a.feed(r.decode(e))}}),o=0,s=new TransformStream({async transform(e,n){let a=r.decode(e);if("[DONE]"===a){n.terminate();return}try{let e=JSON.parse(a),r=e.choices[0].delta?.content||"";if(o<2&&(r.match(/\n/)||[]).length)return;n.enqueue(t.encode(`data: ${JSON.stringify({text:r})}

`)),o++}catch(e){n.error(e)}}});return a.pipeThrough(s)}let l=60;async function u(e){let{messages:t}=await e.json();try{console.log("[getChat] Fetching answer stream from LlamaEdge API");let e={model:process.env.LLAMAEDGE_MODEL_NAME,messages:t,stream:!0},r=await c(e);return new Response(r,{headers:new Headers({"Cache-Control":"no-cache"})})}catch(e){return new Response("Error. Answer stream failed.",{status:202})}}let d=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/getChat/route",pathname:"/api/getChat",filename:"route",bundlePath:"app/api/getChat/route"},resolvedPagePath:"D:\\myCodePlace\\llamatutor\\app\\api\\getChat\\route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:p,staticGenerationAsyncStorage:h,serverHooks:f}=d,m="/api/getChat/route";function v(){return(0,s.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:h})}},9303:(e,t,r)=>{e.exports=r(517)}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[948],()=>r(3090));module.exports=n})();